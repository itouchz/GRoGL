---
title: "RQ1-4: Correlation Analysis with Social Media Texts and News (i.e., Public Opinion)"
author: "CS564 Team 10"
output: html_notebook
---

Load Datasets
```{r}
suppressMessages(library(data.table))
suppressMessages(library(readxl))
suppressMessages(library(dplyr))
suppressMessages(library(stringr))
suppressMessages(library(ggplot2))
suppressMessages(library(ggcorrplot))
suppressMessages(library(tidyr))
suppressMessages(library(rstatix))

set.seed(7)
theme_set(theme_bw())
theme_set(theme_bw())
theme_settings <- theme(
  axis.title.x = element_text(angle = 0, color = "black"), 
  axis.title.y = element_text(angle = 90, color = "black"),
  axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size = 10),
  axis.text.y = element_text(size = 10),
  plot.title = element_text(hjust = 0.5),
)


# Metadata
coin_features <- fread("datasets/coin_features.csv") %>% as.data.frame()
ticker_info <- fread("datasets/ticker_info.csv") %>% as.data.frame()
```


```{r}
n_tweets <- 0

for (fname in list.files("datasets/tweets/cashtags_excel", pattern='*.xlsx')) {
  for (p in period) {
    if (p == "pre") {
        values <- read_excel(paste("datasets/tweets/cashtags_excel", fname, sep = "/")) %>% as.data.frame() %>% filter(date >= "2019-01-01" & date <= "2019-12-31") %>% arrange(date)
    } else if (p == "peri") {
      values <- read_excel(paste("datasets/tweets/cashtags_excel", fname, sep = "/")) %>% as.data.frame() %>% filter(date >= "2020-01-01" & date <= "2020-12-31") %>% arrange(date)
    } else {
      values <- read_excel(paste("datasets/tweets/cashtags_excel", fname, sep = "/")) %>% as.data.frame() %>% filter(date >= "2021-01-01") %>% arrange(date)
    }
  var_name <- paste("tweet", str_split(fname, "\\.", simplify = T)[1], p, sep = ".")
  assign(var_name, values)
  n_tweets <- n_tweets + count(values)
  }
}

n_reddits <- 0
for (fname in list.files("datasets/reddit/subreddit_excel")) {
  for (p in period) {
    if (p == "pre") {
      values <- read_excel(paste("datasets/reddit/subreddit_excel", fname, sep = "/")) %>% as.data.frame() %>% filter(date >= "2019-01-01" & date <= "2019-12-31") %>% arrange(date)
    } else if (p == "peri") {
      values <- read_excel(paste("datasets/reddit/subreddit_excel", fname, sep = "/")) %>% as.data.frame() %>% filter(date >= "2020-01-01" & date <= "2020-12-31") %>% arrange(date)
    } else {
      values <- read_excel(paste("datasets/reddit/subreddit_excel", fname, sep = "/")) %>% as.data.frame() %>% filter(date >= "2021-01-01") %>% arrange(date)
    }
    var_name <- paste("subreddit", str_split(fname, "\\.", simplify = T)[1], p, sep = ".")
    assign(var_name, values)
    n_reddits <- n_reddits + count(values)
  }
}

```

Pre-COVID19
```{r}
s.date <- "2019-01-01"
e.date <- "2019-12-31"

news.cryptocurrency.pre <- read_excel("datasets/news/Cryptocurrency.xlsx") %>% as.data.frame() %>% filter(date >= "2019-01-01" & date <= "2019-12-31") %>% arrange(date)
news.cryptocurrency_exchange.pre <- read_excel("datasets/news/Cryptocurrency_exchange.xlsx") %>% as.data.frame() %>% filter(date >= "2019-01-01" & date <= "2019-12-31") %>% arrange(date)
news.cryptocurrency_market.pre <- read_excel("datasets/news/Cryptocurrency_market.xlsx") %>% as.data.frame() %>% filter(date >= "2019-01-01" & date <= "2019-12-31") %>% arrange(date)

tweet.cryptocurrency.pre <- read_excel("datasets/tweets/Cryptocurrency.xlsx") %>% as.data.frame() %>% filter(date >= "2019-01-01" & date <= "2019-12-31") %>% arrange(date)
reddit.cryptocurrency.pre <- read_excel("datasets/reddit/cryptocurrency_pre.xlsx") %>% as.data.frame() %>% arrange(date)

```

Peri-COVID19
```{r}
news.cryptocurrency.peri <- read_excel("datasets/news/Cryptocurrency.xlsx") %>% as.data.frame() %>% filter(date >= "2020-01-01" & date <= "2020-12-31") %>% arrange(date)
news.cryptocurrency_exchange.peri <- read_excel("datasets/news/Cryptocurrency_exchange.xlsx") %>% as.data.frame() %>% filter(date >= "2020-01-01" & date <= "2020-12-31") %>% arrange(date)
news.cryptocurrency_market.peri <- read_excel("datasets/news/Cryptocurrency_market.xlsx") %>% as.data.frame() %>% filter(date >= "2020-01-01" & date <= "2020-12-31") %>% arrange(date)

tweet.cryptocurrency.peri <- read_excel("datasets/tweets/Cryptocurrency.xlsx") %>% as.data.frame() %>% filter(date >= "2020-01-01" & date <= "2020-12-31") %>% arrange(date)
reddit.cryptocurrency.peri <- read_excel("datasets/reddit/cryptocurrency_peri.xlsx") %>% as.data.frame() %>% arrange(date)


```

Post-COVID19
```{r}
news.cryptocurrency.post <- read_excel("datasets/news/Cryptocurrency.xlsx") %>% as.data.frame() %>% filter(date >= "2021-01-01") %>% arrange(date)
news.cryptocurrency_exchange.post <- read_excel("datasets/news/Cryptocurrency_exchange.xlsx") %>% as.data.frame() %>% filter(date >= "2021-01-01") %>% arrange(date)
news.cryptocurrency_market.post <- read_excel("datasets/news/Cryptocurrency_market.xlsx") %>% as.data.frame() %>% filter(date >= "2021-01-01") %>% arrange(date)

tweet.cryptocurrency.post <- read_excel("datasets/tweets/Cryptocurrency.xlsx") %>% as.data.frame() %>% filter(date >= "2021-01-01") %>% arrange(date)
reddit.cryptocurrency.post <- read_excel("datasets/reddit/cryptocurrency_post.xlsx") %>% as.data.frame() %>% arrange(date)


```

